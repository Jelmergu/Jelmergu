name: PHP Composer

on:
  push:
    branches: [ "develop" ]
  pull_request:
    branches: [ "develop" ]

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Validate composer.json and composer.lock
      run: composer validate --strict

    - name: Cache Composer packages
      id: composer-cache
      uses: actions/cache@v3
      with:
        path: vendor
        key: ${{ runner.os }}-php-${{ hashFiles('**/composer.lock') }}
        restore-keys: |
          ${{ runner.os }}-php-

    - name: Install dependencies
      run: composer install --prefer-dist --no-progress
      
    - name: PHPUnit (graychen)
      # You may pin to the exact commit or the version.
      # uses: Graychen/phpunit-action@026f8104f1a6b5bc646df2d495bc8b34080c3e03
      uses: Graychen/phpunit-action@v1.0.0
      with:
        # Configuration file location
        config: phpunit.xml.dist # optional, default is phpunit.xml.dist
      
    - name: phpunit-coverage-badge
      # You may pin to the exact commit or the version.
      # uses: timkrase/phpunit-coverage-badge@29e63a46fd2b558fadefaa1699c6aa5892bd5791
      uses: timkrase/phpunit-coverage-badge@v1.2.0
      with:
        # The path to the report file generated by PHPUnit.
        report: clover.xml# optional, default is clover.xml
        # The type of the generated report. Currently supported: clover, html.
        report_type: clover# optional, default is clover
        # The path inside the repository where the created badge should be saved. Can be anywhere except inside the .github folder.
        coverage_badge_path: coverage_bage.svg# optional, default is coverage_badge.svg
        # Defines whether the badge will be committed and pushed to the repository.
        push_badge: false # optional, default is false
        # Token to push the badge into the repository. Can be supplied with $/{{ secrets.GITHUB_TOKEN }} (without the "/").
        repo_token: NOT_SUPPLIED # optional, default is NOT_SUPPLIED
        # Commit message that will be used to commit the updated badge and clover file.
        #commit_message: # optional, default is Update code coverage badge
        # Email that will be used for the commit.
        #commit_email: # optional, default is 41898282+github-actions[bot]@users.noreply.github.com
        # Name that will be used for the commit.
        #commit_name: # optional, default is Github Actions Bot
        
    # Add a test script to composer.json, for instance: "test": "vendor/bin/phpunit"
    # Docs: https://getcomposer.org/doc/articles/scripts.md

    # - name: Run test suite
    #   run: composer run-script test
